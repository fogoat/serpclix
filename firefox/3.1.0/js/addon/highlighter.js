window.highlighter_injected||(window.highlighter={highlights:{},serp_alls:new Set,serp_best:null,disabled:!1,high_tm:null,message_extras:{},xyz:{},highlight_delayed:function(e){clearTimeout(this.high_tm),this.high_tm=setTimeout((()=>{this.highlight()}),e||1e3)},highlight:function(){let e=0,t=!1,i=window.location.href.toString();if(this.disabled||!this.highlights||!this.highlights.url_hash){return}let l=this.highlights.type,o=i.includes("google.")&&i.includes("/maps/"),s=i.includes("google.")&&i.includes("tbm=isch"),h=i.includes("google.")&&(i.includes("tbm=nws")||i.includes("news.google.")),r=i.includes("google.")&&(i.includes("tbm=vid")||i.includes("video.google.")),n=i.includes("google.")&&i.includes("/search"),a=i.includes("bing.")&&i.includes("/search"),g=i.includes("youtube.")&&i.includes("/results");const d=/android/i.test(navigator.userAgent);if("googlemaps"==l&&o&&(this.hide_googleads(),e+=this.highlight_googlemaps(),t=!0),"googleimages"==l&&(s?(e+=this.highlight_googleimages("a","div[data-ved]"),0===e&&(e+=this.highlight_anyatt("div"))):n&&(e+=this.highlight_googleimages_topline()),t=!0),"googlenews"==l&&h&&(this.hide_googleads(),e+=this.highlight_anyatt("main article a","main article"),0===e&&(e+=this.highlight_links(".g a","div.g")),0===e&&(e+=this.highlight_links()),t=!0),"google"==l&&n){let t,i;this.hide_googleads(),d?(i="a[href][rel='noopener']",t={parent:"div[data-hveid] div.mnr-c",self:"a[href*='/url?'][href*='ved='][rel='noopener']"}):(i=".g a",t={parent:"div.g",self:"a[ping*='/url?'][ping*='url='][rel='noopener'][data-ved]"}),e+=this.highlight_links(i,t),0===e&&(e+=this.highlight_links("a"))}"googlevideo"==l&&r&&(this.hide_googleads(),e+=this.highlight_links("a","div#search div.g")),"bing"==l&&a&&(e+=this.highlight_links("#b_content li.b_algo a","li.b_algo"),0===e&&(e+=this.highlight_links())),"youtube"==l&&g&&(this.hide_utubeads(),e+=this.highlight_links("a[href*='/watch?']",{parent:"ytd-video-renderer",self:"ytd-video-renderer a[href*='/watch?']"}),e+=this.highlight_links("a[href*='/watch?']",{parent:"ytm-compact-video-renderer",self:"ytm-compact-video-renderer a[href*='/watch?']"})),(0===e||t)&&this.highlight_delayed(e>0?3500:1500)},highlight_links:function(e,t){let i=0,l=[];e=e||"a";let o=(this.highlights.hint||"").toLowerCase().replace(/[^a-zA-Z0-9]/gi,""),s=this.highlights.url_exact?this.highlights.url_hash:this.highlights.url_host_hash,h=this.highlights.salt;l=document.querySelectorAll(e);for(let e=0;e<l.length;e++){let r=l[e],n=r.href||"";n=this.unpack_ggl_url(n);let a=n,g=r.textContent.toLowerCase().replace(/[^a-zA-Z0-9]/gi,"");r.addEventListener("mouseover",(e=>{this.keep_xyz("h",e)})),r.addEventListener("mousedown",(e=>{this.keep_xyz("d",e),this.send_grabba_message({elhref:n,elcontent:e.target.textContent,elxyz:this.get_xyz(e)})})),a=this.highlights.url_exact?this.simplify_url(n.toLowerCase(),this.highlights.url_keep_qs):this.simplify_url_domain(n.toLowerCase()),s!=md5(h+a)?o&&g.indexOf(o)>=0&&(i+=1,this.colorize_element(r)):(i+=1,this.send_grabba_message({highhref:n,highcontent:r.textContent}),this.colorize_element(r),t&&this.save_serp_position(r,t))}return i},highlight_googlemaps:function(e,t){let i=0,l=[];e=e||"div#pane div[aria-label] span",t=t||"div#pane div, div#pane span";let o=(this.highlights.hint||"").toLowerCase().replace(/[^a-zA-Z0-9]/gi,""),s=this.highlights.url_hash,h=this.highlights.url_host_hash,r=this.highlights.salt;l=document.querySelectorAll(e);for(let e=0;e<l.length;e++){let t=l[e],s=t.textContent.toLowerCase().replace(/[^a-zA-Z0-9]/gi,"");o&&s.indexOf(o)>=0&&(this.colorize_element_google_maps(t),i+=1)}l=document.querySelectorAll(t);for(let e=0;e<l.length;e++){let t=l[e],o=this.simplify_url(t.textContent.toLowerCase());t.addEventListener("mousedown",(e=>{this.keep_xyz("d",e),this.send_grabba_message({elhref:o,elcontent:e.target.textContent,elxyz:this.get_xyz(e)})})),s!=md5(r+o)&&h!=md5(r+o)||(this.send_grabba_message({highhref:o,highcontent:t.textContent}),this.colorize_element_google_maps(t),i+=1)}return i},highlight_googleimages_topline:function(){let e=0;if(e+=this.highlight_anyatt("g-section-with-header div",null,{parent:"g-section-with-header",child:"img"}),0==e){document.querySelectorAll("#top_nav a[href*='tbm=isch']").forEach((e=>{this.colorize_element_default(e)})),document.querySelectorAll("g-more-link a[href*='tbm=isch']").forEach((e=>{this.colorize_element_default(e)})),document.querySelectorAll("a[href*='tbm=isch'][href*='/search?q=']").forEach((e=>{this.colorize_element_default(e)}))}else{let e=document.querySelector("g-scrolling-carousel g-right-button");e&&this.colorize_element_default(e),document.querySelectorAll("g-scrolling-carousel g-img img").forEach((e=>{e.style.filter||(e.style.filter="grayscale(1) brightness(2) opacity(0.33) blur(3px)")}))}},highlight_googleimages:function(e){let t=0,i=[];e=e||"a";let l=this.highlights.url_exact?this.highlights.url_hash:this.highlights.url_host_hash,o=this.highlights.salt;i=document.querySelectorAll(e);for(let e=0;e<i.length;e++){let s=i[e],h=s.href||"",r=h;s.addEventListener("mouseover",(e=>{this.keep_xyz("h",e)})),s.addEventListener("mousedown",(e=>{this.keep_xyz("d",e),this.send_grabba_message({elhref:h,elcontent:e.target.textContent,elxyz:this.get_xyz(e)})}));let n=new RegExp("imgrefurl=([^&#]+)","ig"),a=h.match(n);a&&a[1]&&(h=decodeURIComponent(a[1].replace(/\+/g," ")),r=this.simplify_url(hrefref.toLowerCase())),r=this.highlights.url_exact?this.simplify_url(h.toLowerCase(),this.highlights.url_keep_qs):this.simplify_url_domain(h.toLowerCase()),l==md5(o+r)&&(this.send_grabba_message({highhref:r,highcontent:s.textContent}),this.colorize_element_google_images(s),this.save_serp_position(s,{parent:"div[data-ved][class~='isv-r']",self:"a[href*='imgrefurl']"}),t+=1)}return t},highlight_anyatt:function(e,t,i){let l=0,o=[];e=e||"a";let s=this.highlights.url_exact?this.highlights.url_hash:this.highlights.url_host_hash,h=this.highlights.salt,r=new RegExp("(https?://.*?)($|[; \"'])","i");o=document.querySelectorAll(e);for(let e=0;e<o.length;e++){let n=o[e];for(let e=0;e<n.attributes.length;e++){let o=(n.attributes[e].value||"").match(r);if(o&&o[1]){let e=decodeURIComponent(String(o[1]).replace(/\+/g," ")),r=e;r=this.highlights.url_exact?this.simplify_url(e.toLowerCase(),this.highlights.url_keep_qs):this.simplify_url_domain(e.toLowerCase()),s==md5(h+r)&&(this.send_grabba_message({highhref:r,highcontent:n.textContent}),this.colorize_element(n,i),t&&this.save_serp_position(n,t),l+=1)}}}return l},hide_googleads:function(e){e=e||[["li.ads-ad","ol"],["li.ads-fr","ol"],["li[class*='ads-']","ol"],["div[aria-label='Ads']",null],["div#tvcap",null],["div#tads",null],["div#topads",null],["div#bottomads",null],["div.ad_cclk",null],["a[href*='googleadservices']","div"],["w-visurl","a"],["a[onmousedown*='google.arwt']","div"],["a[onmousedown*='window[this.getAttribute(\\'data-mousedown\\')](this)']","div"],["a[href*='/aclk?'][data-al]","div"],["a[data-tu*='/aclk?']","div"],["div[data-result-ad-type]","div"],["a[data-rw*='/aclk?']","div"],[".commercial-unit-desktop-rhs",null],[".commercial-unit-desktop-top",null],[".commercial-unit-mobile-top",null],[".commercial-unit-mobile-bottom",null]],this.hide_ads(e);let t=document.querySelectorAll("a");for(let e=0;e<t.length;e++){let i=t[e];for(let e=0;e<i.attributes.length;e++){let t=i.attributes[e];/^data-|^href/i.test(t.nodeName)&&/googleadservices\.com|\/aclk\?sa=/i.test(t.nodeValue)&&(this.hide_ad_el(i),!i||"A"!=i.tagName&&"a"!=i.tagName||i.setAttribute("href","https://google.com/?dbltap"))}}},hide_utubeads:function(e){e=e||[[".masthead-ad-control",null],["#masthead-ad",null],["#promotion-shelf",null],[".ad-div",null],[".ytp-ad-module",null],[".ytd-carousel-ad-renderer",null],["ytd-promoted-sparkles-web-renderer",".ytd-item-section-renderer"],["ytm-promoted-sparkles-web-renderer",".ytd-item-section-renderer"]],this.hide_ads(e)},hide_ads:function(e){for(let t=0;t<e.length;t++){let i=document.querySelectorAll(e[t][0]),l=e[t][1];for(let e=0;e<i.length;e++){let t=i[e],o=l?t.closest(l):t;o&&this.hide_ad_el(o)}}},hide_ad_el:function(e){try{e.style.display="none",e.style.visibility="hidden",e.style.opacity="0.1",e.style.backgroundColor="green",e.style.height="3px",e.style.overflow="hidden",e.disabled=!0}catch(e){}},colorize_element:function(e,t){try{t?this.colorize_element_default(e,t):window.location.href.toString().includes("google.")?this.colorize_element_google(e,"div.g"):window.location.href.toString().includes("youtube.")?this.colorize_element_google(e,"ytd-video-renderer"):window.location.href.toString().includes("bing.")?this.colorize_element_bing(e):this.colorize_element_default(e)}catch(e){}},colorize_element_google:function(e,t){let i=e.closest(t||"div");i?(e.style.color="maroon",e.style.fontWeight="bold",i.classList.contains("osl")?(i.style.backgroundColor="#ffd7d7",i.style.boxShadow="0 0 4px coral",i.style.border="1px solid #fddd9b",e.style.backgroundColor="lightyellow"):(i.style.backgroundColor="#ff8787",i.style.boxShadow="0 0 4px coral",i.style.border="1px solid #fddd9b")):this.colorize_element_default(e)},colorize_element_google_maps:function(e){e.style.backgroundColor="#b1ff87",e.style.color="#004400",e.style.fontWeight="bold",e.style.border="2px solid crimson",e.style.padding="2px 6px",e.style.boxShadow="0 0 20px coral"},colorize_element_google_images:function(e){e.style.border="5px solid coral",e.style.boxShadow="0 0 20px yellow",e.style.backgroundColor="#b1ff87";let t=e.parentNode.childNodes;for(let i=0;i<t.length;i++){t[i]!=e&&(t[i].style.backgroundColor="gold",t[i].style.color="black")}},colorize_element_bing:function(e){let t=e.closest("li.b_algo")||e.parentNode;t.style.backgroundColor="#ff8787",t.style.boxShadow="0 0 3px coral",e.style.color="maroon",e.style.fontWeight="bold"},colorize_element_default:function(e,t){let i=t&&t.parent||null,l=t&&t.child||null;e.style.backgroundColor="#fddd9b",e.style.color="#ffff7f",e.style.fontWeight="bold",e.style.boxShadow="3px 3px 10px #fddd9b, 0 0 5px #fddd9b inset",e.style.border="4px solid #ff8787";let o=i&&e.closest(i)||e.parentNode;if(o&&(o.style.backgroundColor="#ffd7d7",o.style.boxShadow="0 0 3px yellow inset, 0 0 3px #ffd7d7",o.style.border="2px solid #ffd7d7"),l){let t=e.querySelector(l);t&&(t.style.backgroundColor="lightyellow",t.style.boxShadow="3px 3px 8px salmon, 0 0 5px salmon inset",t.style.border="3px solid red","img"==l&&(t.style.filter="saturate(2.00) contrast(1.33) drop-shadow(0 0 10px crimson)"))}},save_serp_position:function(e,t){let i=t&&t.parent||t||"div",l=t&&t.self||null,o=i&&e.closest(i)||e.parentNode,s=b=0,h=null,r=null;if(i){let e=document.querySelectorAll(i);r=e&&e.length;let t=0;for(t=0;t<e.length;t++){if(e[t].isSameNode(o)){h=t;break}}}let n=null,a=0;if(l){let t=document.querySelectorAll(l);a=t&&t.length;let i=0;for(i=0;i<t.length;i++){if(t[i].isSameNode(e)){n=i;break}}}let g=new URLSearchParams(window.location.search),d=Number(g.get("start"))||Number(g.get("first"))||0,c={};if(null===h&&null===n){return}let u=[s,b,h,d,r,n,a];if(this.serp_alls.size<10&&this.serp_alls.add(JSON.stringify(u)),c.serp_positions=Array.from(this.serp_alls),!this.serp_best||null===this.serp_best[2]||(Number(this.serp_best[2])||0)>u[2]){this.serp_best=u;let e=String(o.textContent).replace(/[\n\r\s]{2,}/gi," ").trim(),t=o.className;c.serp_position=this.serp_best,c.serp_box=e.substring(0,100),c.serp_box_class=t}this.send_grabba_message(c)},simplify_url:function(e,t){if(!e||String(e).match(/^(about|chrome|javascript|file):/gi)){return null}e.indexOf("://")<0&&(e="https://"+e);let i=null;try{i=new URL(e)}catch(e){return null}let l=this.simplify_www(i.hostname),o=String(i.pathname).replace(/\/$/gi,""),s=Array.from(i.searchParams),h="";if(t){let e=s.filter((e=>e[0]&&t.indexOf(e[0])>=0));if(e.length>0&&t.length>0){e.sort((function cmp(e,t){return e[0]>t[0]?1:e[0]<t[0]?-1:0}));for(let t=0;t<e.length;t++){h+=(0==t?"?":"&")+e[t][0]+"="+e[t][1]}}}return`${l}${o}${h}`},simplify_url_domain:function(e){if(!e||String(e).match(/^(about|chrome|javascript|file):/gi)){return null}e.indexOf("://")<0&&(e="https://"+e);try{let t=new URL(e);return this.simplify_www(t.hostname)}catch(e){return null}},simplify_www:function(e){return String(e).replace(/^www\./gi,"").replace(/\.m\./gi,".").replace(/^m\./gi,"").toLowerCase()},unpack_ggl_url:function(e){if(e&&e.includes("google.")&&e.includes("/url?q=http")){let t=new RegExp("/url\\?q=(http[^&]+)","ig").exec(e);if(t&&t[1]){return decodeURIComponent(t[1].replace(/\+/g," "))}}return e},send_grabba_message:function(e){let t=document.getElementById("search");t&&t.innerText||(t=document.body);let i=String(t.innerText).replace(/[\n\r\s]{2,}/gi," ").trim(),l={serppa:new Date(Date.now()).toISOString()||!0,pglocation:window.location.href.toString(),pgreferrer:document.referrer,pgcontent:i.substring(0,2048),pgtitle:document.title};(e||this.message_extras)&&(Object.assign(this.message_extras,e),Object.assign(l,this.message_extras)),browser.runtime.sendMessage(l)},get_xyz:function(e){return this.xyz},keep_xyz:function(e,t){this.xyz[e]=[t.pageX,t.pageY,t.offsetX,t.offsetY,(new Date).getTime()],Number(this.xyz[e+"_c"])?this.xyz[e+"_c"]++:this.xyz[e+"_c"]=1}},window.highlighter_injected=!0,"complete"==document.readyState?window.highlighter.highlight_delayed(333):window.addEventListener("load",(()=>{window.highlighter.highlight_delayed(333)})),window.addEventListener("mousedown",(e=>{window.highlighter.highlight_delayed(1250),window.highlighter.keep_xyz("d",e)})),window.addEventListener("mouseup",(e=>{window.highlighter.keep_xyz("u",e)})),document.addEventListener("mousemove",(e=>{window.highlighter.keep_xyz("mm",e)})),window.addEventListener("touchstart",(e=>{window.highlighter.keep_xyz("t",e)})),browser.runtime.onMessage.addListener((e=>{e&&e.highlights&&(window.highlighter.highlights=e.highlights||[],"complete"!=document.readyState&&"interactive"!=document.readyState||window.highlighter.highlight_delayed(500)),e&&e.grabba&&window.highlighter.send_grabba_message(),e&&e.highdisable&&(window.highlighter.disabled=!0)})));