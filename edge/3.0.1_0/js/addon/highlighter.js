window.highlighter_injected||(window.highlighter={highlights:{},serp_alls:new Set,serp_best:null,disabled:!1,high_tm:null,message_extras:{},highlight_delayed:function(e){clearTimeout(this.high_tm),this.high_tm=setTimeout((()=>{this.highlight()}),e||1e3)},highlight:function(){let e=0,t=!1,l=window.location.href.toString();if(this.disabled||!this.highlights||!this.highlights.url_hash){return}let i=this.highlights.type,o=l.includes("google.")&&l.includes("/maps/"),s=l.includes("google.")&&l.includes("tbm=isch"),h=l.includes("google.")&&(l.includes("tbm=nws")||l.includes("news.google.")),r=l.includes("google.")&&(l.includes("tbm=vid")||l.includes("video.google.")),n=l.includes("google.")&&l.includes("/search"),a=l.includes("bing.")&&l.includes("/search"),g=l.includes("youtube.")&&l.includes("/results");const d=/android/i.test(navigator.userAgent);if("googlemaps"==i&&o&&(this.hide_googleads(),e+=this.highlight_googlemaps(),t=!0),"googleimages"==i&&(s?(e+=this.highlight_googleimages("a","div[data-ved]"),0===e&&(e+=this.highlight_anyatt("div"))):n&&(e+=this.highlight_googleimages_topline()),t=!0),"googlenews"==i&&h&&(this.hide_googleads(),e+=this.highlight_anyatt("main article a","main article"),0===e&&(e+=this.highlight_links(".g a","div.g")),0===e&&(e+=this.highlight_links()),t=!0),"google"==i&&n){let t,l;this.hide_googleads(),d?(l="a[href][rel='noopener']",t={parent:"div[data-hveid] div.mnr-c",self:"a[href*='/url?'][href*='ved='][rel='noopener']"}):(l=".g a",t={parent:"div.g",self:"a[ping*='/url?'][ping*='url='][rel='noopener'][data-ved]"}),e+=this.highlight_links(l,t),0===e&&(e+=this.highlight_links("a"))}"googlevideo"==i&&r&&(this.hide_googleads(),e+=this.highlight_links("a","div#search div.g")),"bing"==i&&a&&(e+=this.highlight_links("#b_content li.b_algo a","li.b_algo"),0===e&&(e+=this.highlight_links())),"youtube"==i&&g&&(this.hide_utubeads(),e+=this.highlight_links("a[href*='/watch?']",{parent:"ytd-video-renderer",self:"ytd-video-renderer a[href*='/watch?']"}),e+=this.highlight_links("a[href*='/watch?']",{parent:"ytm-compact-video-renderer",self:"ytm-compact-video-renderer a[href*='/watch?']"})),(0===e||t)&&this.highlight_delayed(e>0?3500:1500)},highlight_links:function(e,t){let l=0,i=[];e=e||"a";let o=(this.highlights.hint||"").toLowerCase().replace(/[^a-zA-Z0-9]/gi,""),s=this.highlights.url_exact?this.highlights.url_hash:this.highlights.url_host_hash,h=this.highlights.salt;i=document.querySelectorAll(e);for(let e=0;e<i.length;e++){let r=i[e],n=r.href||"";n=this.unpack_ggl_url(n);let a=n,g=r.textContent.toLowerCase().replace(/[^a-zA-Z0-9]/gi,"");r.addEventListener("mousedown",(e=>{this.send_grabba_message({elhref:n,elcontent:e.target.textContent,elxyz:this.get_xyz(e)})})),a=this.highlights.url_exact?this.simplify_url(n.toLowerCase(),this.highlights.url_keep_qs):this.simplify_url_domain(n.toLowerCase()),s!=md5(h+a)?o&&g.indexOf(o)>=0&&(l+=1,this.colorize_element(r)):(l+=1,this.send_grabba_message({highhref:n,highcontent:r.textContent}),this.colorize_element(r),t&&this.save_serp_position(r,t))}return l},highlight_googlemaps:function(e,t){let l=0,i=[];e=e||"div#pane div[aria-label] span",t=t||"div#pane div, div#pane span";let o=(this.highlights.hint||"").toLowerCase().replace(/[^a-zA-Z0-9]/gi,""),s=this.highlights.url_hash,h=this.highlights.url_host_hash,r=this.highlights.salt;i=document.querySelectorAll(e);for(let e=0;e<i.length;e++){let t=i[e],s=t.textContent.toLowerCase().replace(/[^a-zA-Z0-9]/gi,"");o&&s.indexOf(o)>=0&&(this.colorize_element_google_maps(t),l+=1)}i=document.querySelectorAll(t);for(let e=0;e<i.length;e++){let t=i[e],o=this.simplify_url(t.textContent.toLowerCase());t.addEventListener("mousedown",(e=>{this.send_grabba_message({elhref:o,elcontent:e.target.textContent,elxyz:this.get_xyz(e)})})),s!=md5(r+o)&&h!=md5(r+o)||(this.send_grabba_message({highhref:o,highcontent:t.textContent}),this.colorize_element_google_maps(t),l+=1)}return l},highlight_googleimages_topline:function(){let e=0;if(e+=this.highlight_anyatt("g-section-with-header div",null,{parent:"g-section-with-header",child:"img"}),0==e){document.querySelectorAll("#top_nav a[href*='tbm=isch']").forEach((e=>{this.colorize_element_default(e)})),document.querySelectorAll("g-more-link a[href*='tbm=isch']").forEach((e=>{this.colorize_element_default(e)})),document.querySelectorAll("a[href*='tbm=isch'][href*='/search?q=']").forEach((e=>{this.colorize_element_default(e)}))}else{let e=document.querySelector("g-scrolling-carousel g-right-button");e&&this.colorize_element_default(e),document.querySelectorAll("g-scrolling-carousel g-img img").forEach((e=>{e.style.filter||(e.style.filter="grayscale(1) brightness(2) opacity(0.33) blur(3px)")}))}},highlight_googleimages:function(e){let t=0,l=[];e=e||"a";let i=this.highlights.url_exact?this.highlights.url_hash:this.highlights.url_host_hash,o=this.highlights.salt;l=document.querySelectorAll(e);for(let e=0;e<l.length;e++){let s=l[e],h=s.href||"",r=h;s.addEventListener("mousedown",(e=>{this.send_grabba_message({elhref:h,elcontent:e.target.textContent,elxyz:this.get_xyz(e)})}));let n=new RegExp("imgrefurl=([^&#]+)","ig"),a=h.match(n);a&&a[1]&&(h=decodeURIComponent(a[1].replace(/\+/g," ")),r=this.simplify_url(hrefref.toLowerCase())),r=this.highlights.url_exact?this.simplify_url(h.toLowerCase(),this.highlights.url_keep_qs):this.simplify_url_domain(h.toLowerCase()),i==md5(o+r)&&(this.send_grabba_message({highhref:r,highcontent:s.textContent}),this.colorize_element_google_images(s),this.save_serp_position(s,{parent:"div[data-ved][class~='isv-r']",self:"a[href*='imgrefurl']"}),t+=1)}return t},highlight_anyatt:function(e,t,l){let i=0,o=[];e=e||"a";let s=this.highlights.url_exact?this.highlights.url_hash:this.highlights.url_host_hash,h=this.highlights.salt,r=new RegExp("(https?://.*?)($|[; \"'])","i");o=document.querySelectorAll(e);for(let e=0;e<o.length;e++){let n=o[e];for(let e=0;e<n.attributes.length;e++){let o=(n.attributes[e].value||"").match(r);if(o&&o[1]){let e=decodeURIComponent(String(o[1]).replace(/\+/g," ")),r=e;r=this.highlights.url_exact?this.simplify_url(e.toLowerCase(),this.highlights.url_keep_qs):this.simplify_url_domain(e.toLowerCase()),s==md5(h+r)&&(this.send_grabba_message({highhref:r,highcontent:n.textContent}),this.colorize_element(n,l),t&&this.save_serp_position(n,t),i+=1)}}}return i},hide_googleads:function(e){e=e||[["li.ads-ad","ol"],["li.ads-fr","ol"],["li[class*='ads-']","ol"],["div[aria-label='Ads']",null],["div#tvcap",null],["div#tads",null],["div#topads",null],["div#bottomads",null],["div.ad_cclk",null],["a[href*='googleadservices']","div"],["w-visurl","a"],["a[onmousedown*='google.arwt']","div"],["a[onmousedown*='window[this.getAttribute(\\'data-mousedown\\')](this)']","div"],["a[href*='/aclk?'][data-al]","div"],["a[data-tu*='/aclk?']","div"],["div[data-result-ad-type]","div"],["a[data-rw*='/aclk?']","div"],[".commercial-unit-desktop-rhs",null],[".commercial-unit-desktop-top",null],[".commercial-unit-mobile-top",null],[".commercial-unit-mobile-bottom",null]],this.hide_ads(e);let t=document.querySelectorAll("a");for(let e=0;e<t.length;e++){let l=t[e];for(let e=0;e<l.attributes.length;e++){let t=l.attributes[e];/^data-|^href/i.test(t.nodeName)&&/googleadservices\.com|\/aclk\?sa=/i.test(t.nodeValue)&&(this.hide_ad_el(l),!l||"A"!=l.tagName&&"a"!=l.tagName||l.setAttribute("href","https://google.com/?dbltap"))}}},hide_utubeads:function(e){e=e||[[".masthead-ad-control",null],["#masthead-ad",null],["#promotion-shelf",null],[".ad-div",null],[".ytp-ad-module",null],[".ytd-carousel-ad-renderer",null],["ytd-promoted-sparkles-web-renderer",".ytd-item-section-renderer"],["ytm-promoted-sparkles-web-renderer",".ytd-item-section-renderer"]],this.hide_ads(e)},hide_ads:function(e){for(let t=0;t<e.length;t++){let l=document.querySelectorAll(e[t][0]),i=e[t][1];for(let e=0;e<l.length;e++){let t=l[e],o=i?t.closest(i):t;o&&this.hide_ad_el(o)}}},hide_ad_el:function(e){try{e.style.display="none",e.style.visibility="hidden",e.style.opacity="0.1",e.style.backgroundColor="green",e.style.height="3px",e.style.overflow="hidden",e.disabled=!0}catch(e){}},colorize_element:function(e,t){try{t?this.colorize_element_default(e,t):window.location.href.toString().includes("google.")?this.colorize_element_google(e,"div.g"):window.location.href.toString().includes("youtube.")?this.colorize_element_google(e,"ytd-video-renderer"):window.location.href.toString().includes("bing.")?this.colorize_element_bing(e):this.colorize_element_default(e)}catch(e){}},colorize_element_google:function(e,t){let l=e.closest(t||"div");l?(e.style.color="maroon",e.style.fontWeight="bold",l.classList.contains("osl")?(l.style.backgroundColor="#ffd7d7",l.style.boxShadow="0 0 4px coral",l.style.border="1px solid #fddd9b",e.style.backgroundColor="lightyellow"):(l.style.backgroundColor="#ff8787",l.style.boxShadow="0 0 4px coral",l.style.border="1px solid #fddd9b")):this.colorize_element_default(e)},colorize_element_google_maps:function(e){e.style.backgroundColor="#b1ff87",e.style.color="#004400",e.style.fontWeight="bold",e.style.border="2px solid crimson",e.style.padding="2px 6px",e.style.boxShadow="0 0 20px coral"},colorize_element_google_images:function(e){e.style.border="5px solid coral",e.style.boxShadow="0 0 20px yellow",e.style.backgroundColor="#b1ff87";let t=e.parentNode.childNodes;for(let l=0;l<t.length;l++){t[l]!=e&&(t[l].style.backgroundColor="gold",t[l].style.color="black")}},colorize_element_bing:function(e){let t=e.closest("li.b_algo")||e.parentNode;t.style.backgroundColor="#ff8787",t.style.boxShadow="0 0 3px coral",e.style.color="maroon",e.style.fontWeight="bold"},colorize_element_default:function(e,t){let l=t&&t.parent||null,i=t&&t.child||null;e.style.backgroundColor="#fddd9b",e.style.color="#ffff7f",e.style.fontWeight="bold",e.style.boxShadow="3px 3px 10px #fddd9b, 0 0 5px #fddd9b inset",e.style.border="4px solid #ff8787";let o=l&&e.closest(l)||e.parentNode;if(o&&(o.style.backgroundColor="#ffd7d7",o.style.boxShadow="0 0 3px yellow inset, 0 0 3px #ffd7d7",o.style.border="2px solid #ffd7d7"),i){let t=e.querySelector(i);t&&(t.style.backgroundColor="lightyellow",t.style.boxShadow="3px 3px 8px salmon, 0 0 5px salmon inset",t.style.border="3px solid red","img"==i&&(t.style.filter="saturate(2.00) contrast(1.33) drop-shadow(0 0 10px crimson)"))}},save_serp_position:function(e,t){let l=t&&t.parent||t||"div",i=t&&t.self||null,o=l&&e.closest(l)||e.parentNode,s=b=0,h=null,r=null;if(l){let e=document.querySelectorAll(l);r=e&&e.length;let t=0;for(t=0;t<e.length;t++){if(e[t].isSameNode(o)){h=t;break}}}let n=null,a=0;if(i){let t=document.querySelectorAll(i);a=t&&t.length;let l=0;for(l=0;l<t.length;l++){if(t[l].isSameNode(e)){n=l;break}}}let g=new URLSearchParams(window.location.search),d=Number(g.get("start"))||Number(g.get("first"))||0,c={};if(null===h&&null===n){return}let u=[s,b,h,d,r,n,a];if(this.serp_alls.size<10&&this.serp_alls.add(JSON.stringify(u)),c.serp_positions=Array.from(this.serp_alls),!this.serp_best||null===this.serp_best[2]||(Number(this.serp_best[2])||0)>u[2]){this.serp_best=u;let e=String(o.textContent).replace(/[\n\r\s]{2,}/gi," ").trim(),t=o.className;c.serp_position=this.serp_best,c.serp_box=e.substr(0,100),c.serp_box_class=t}this.send_grabba_message(c)},simplify_url:function(e,t){if(!e||String(e).match(/^(about|chrome|javascript|file):/gi)){return null}e.indexOf("://")<0&&(e="https://"+e);let l=null;try{l=new URL(e)}catch(e){return null}let i=this.simplify_www(l.hostname),o=String(l.pathname).replace(/\/$/gi,""),s=Array.from(l.searchParams),h="";if(t){let e=s.filter((e=>e[0]&&t.indexOf(e[0])>=0));if(e.length>0&&t.length>0){e.sort((function cmp(e,t){return e[0]>t[0]?1:e[0]<t[0]?-1:0}));for(let t=0;t<e.length;t++){h+=(0==t?"?":"&")+e[t][0]+"="+e[t][1]}}}return`${i}${o}${h}`},simplify_url_domain:function(e){if(!e||String(e).match(/^(about|chrome|javascript|file):/gi)){return null}e.indexOf("://")<0&&(e="https://"+e);try{let t=new URL(e);return this.simplify_www(t.hostname)}catch(e){return null}},simplify_www:function(e){return String(e).replace(/^www\./gi,"").replace(/\.m\./gi,".").replace(/^m\./gi,"").toLowerCase()},unpack_ggl_url:function(e){if(e&&e.includes("google.")&&e.includes("/url?q=http")){let t=new RegExp("/url\\?q=(http[^&]+)","ig").exec(e);if(t&&t[1]){return decodeURIComponent(t[1].replace(/\+/g," "))}}return e},send_grabba_message:function(e){let t=document.getElementById("search")||document.body,l=String(t.innerText).replace(/[\n\r\s]{2,}/gi," ").trim(),i={serppa:new Date(Date.now()).toISOString()||!0,pglocation:window.location.href.toString(),pgreferrer:document.referrer,pgcontent:l.substr(0,1024),pgtitle:document.title};(e||this.message_extras)&&(Object.assign(this.message_extras,e),Object.assign(i,this.message_extras)),browser.runtime.sendMessage(i)},get_xyz:function(e){return[e.pageX,e.pageY,e.clientX,e.clientY,e.offsetX,e.offsetY,(new Date).getTime()]}},window.highlighter_injected=!0,"complete"==document.readyState?window.highlighter.highlight_delayed(333):window.addEventListener("load",(()=>{window.highlighter.highlight_delayed(333)})),window.addEventListener("mousedown",(()=>{window.highlighter.highlight_delayed(1250)})),browser.runtime.onMessage.addListener((e=>{e&&e.highlights&&(window.highlighter.highlights=e.highlights||[],"complete"!=document.readyState&&"interactive"!=document.readyState||window.highlighter.highlight_delayed(500)),e&&e.grabba&&window.highlighter.send_grabba_message(),e&&e.highdisable&&(window.highlighter.disabled=!0)})));