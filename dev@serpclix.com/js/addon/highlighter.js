window.highlighter_injected||(window.highlighter={highlights:{},serp_positions:[],disabled:!1,high_tm:null,message_extras:{},highlight_delayed:function(e){clearTimeout(this.high_tm),this.high_tm=setTimeout((()=>{this.highlight()}),e||1e3)},highlight:function(){let e=0,t=!1,i=window.location.href.toString();if(this.disabled||!this.highlights||!this.highlights.url_hash)return;let l=this.highlights.type,o=i.includes("google.")&&i.includes("/maps/"),s=i.includes("google.")&&i.includes("tbm=isch"),h=i.includes("google.")&&(i.includes("tbm=nws")||i.includes("news.google.")),n=i.includes("google.")&&(i.includes("tbm=vid")||i.includes("video.google.")),r=i.includes("google.")&&i.includes("/search"),g=i.includes("bing.")&&i.includes("/search"),a=i.includes("youtube.")&&i.includes("/results");"googlemaps"==l&&o&&(this.hide_googleads(),e+=this.highlight_googlemaps(),t=!0),"googleimages"==l&&(s?e+=this.highlight_googleimages("a","div[data-ved]"):r&&(e+=this.highlight_googleimages_topline("g-section-with-header div",null,"g-section-with-header","img")),t=!0),"googlenews"==l&&h&&(this.hide_googleads(),e+=this.highlight_anyatt("main article a","main article"),0===e&&(e+=this.highlight_links(".g a","div.g")),0===e&&(e+=this.highlight_links()),t=!0),"google"==l&&r&&(this.hide_googleads(),e+=this.highlight_links(".g a","div.g"),0===e&&(e+=this.highlight_links("a"))),"googlevideo"==l&&n&&(this.hide_googleads(),e+=this.highlight_links("a","div.g")),"bing"==l&&g&&(e+=this.highlight_links("#b_content li.b_algo a","li.b_algo"),0===e&&(e+=this.highlight_links())),"youtube"==l&&a&&(this.hide_utubeads(),e+=this.highlight_links("a","ytd-video-renderer")),(0===e||t)&&this.highlight_delayed(e>0?3e3:1500)},highlight_links:function(e,t){let i=0,l=[];e=e||"a";let o=(this.highlights.hint||"").toLowerCase().replace(/[^a-zA-Z0-9]/gi,""),s=this.highlights.url_exact?this.highlights.url_hash:this.highlights.url_host_hash,h=this.highlights.salt;l=document.querySelectorAll(e);for(let e=0;e<l.length;e++){let n=l[e],r=n.href||"";r=this.unpack_ggl_url(r);let g=r,a=n.textContent.toLowerCase().replace(/[^a-zA-Z0-9]/gi,"");n.addEventListener("mousedown",(e=>{this.send_grabba_message({elhref:r,elcontent:e.target.textContent,elxyz:this.get_xyz(e)})})),g=this.highlights.url_exact?this.simplify_url(r.toLowerCase(),this.highlights.url_keep_qs):this.simplify_url_domain(r.toLowerCase()),s!=md5(h+g)?o&&a.indexOf(o)>=0&&(i+=1,this.colorize_element(n)):(i+=1,this.send_grabba_message({highhref:r,highcontent:n.textContent}),this.colorize_element(n),t&&this.save_serp_position(n,t))}return i},highlight_googlemaps:function(e,t){let i=0,l=[];e=e||"div#pane div[aria-label] span",t=t||"div#pane div, div#pane span";let o=(this.highlights.hint||"").toLowerCase().replace(/[^a-zA-Z0-9]/gi,""),s=this.highlights.url_hash,h=this.highlights.url_host_hash,n=this.highlights.salt;l=document.querySelectorAll(e);for(let e=0;e<l.length;e++){let t=l[e],s=t.textContent.toLowerCase().replace(/[^a-zA-Z0-9]/gi,"");o&&s.indexOf(o)>=0&&(this.colorize_element_google_maps(t),i+=1)}l=document.querySelectorAll(t);for(let e=0;e<l.length;e++){let t=l[e],o=this.simplify_url(t.textContent.toLowerCase());t.addEventListener("mousedown",(e=>{this.send_grabba_message({elhref:o,elcontent:e.target.textContent,elxyz:this.get_xyz(e)})})),s!=md5(n+o)&&h!=md5(n+o)||(this.send_grabba_message({highhref:o,highcontent:t.textContent}),this.colorize_element_google_maps(t),i+=1)}return i},highlight_googleimages_topline:function(e,t){let i=0;if(i+=this.highlight_anyatt("g-section-with-header div",null,"g-section-with-header","img"),0==i)document.querySelectorAll("#top_nav a[href*='tbm=isch']").forEach((e=>{this.colorize_element_default(e)})),document.querySelectorAll("g-more-link a[href*='tbm=isch']").forEach((e=>{this.colorize_element_default(e)}));else{let e=document.querySelector("g-scrolling-carousel g-right-button");e&&this.colorize_element_default(e),document.querySelectorAll("g-scrolling-carousel g-img img").forEach((e=>{e.style.filter||(e.style.filter="grayscale(1) brightness(2) opacity(0.33) blur(3px)")}))}},highlight_googleimages:function(e,t){let i=0,l=[];e=e||"a";let o=this.highlights.url_exact?this.highlights.url_hash:this.highlights.url_host_hash,s=this.highlights.salt;l=document.querySelectorAll(e);for(let e=0;e<l.length;e++){let h=l[e],n=h.href||"",r=n;h.addEventListener("mousedown",(e=>{this.send_grabba_message({elhref:n,elcontent:e.target.textContent,elxyz:this.get_xyz(e)})}));let g=new RegExp("imgrefurl=([^&#]+)","ig"),a=n.match(g);a&&a[1]&&(n=decodeURIComponent(a[1].replace(/\+/g," ")),r=this.simplify_url(hrefref.toLowerCase())),r=this.highlights.url_exact?this.simplify_url(n.toLowerCase(),this.highlights.url_keep_qs):this.simplify_url_domain(n.toLowerCase()),o==md5(s+r)&&(this.send_grabba_message({highhref:r,highcontent:h.textContent}),this.colorize_element_google_images(h),t&&this.save_serp_position(h,t),i+=1)}return i},highlight_anyatt:function(e,t,i,l){let o=0,s=[];e=e||"a";let h=this.highlights.url_exact?this.highlights.url_hash:this.highlights.url_host_hash,n=this.highlights.salt,r=new RegExp("(https?://.*?)($|[; \"'])","i");s=document.querySelectorAll(e);for(let e=0;e<s.length;e++){let g=s[e];for(let e=0;e<g.attributes.length;e++){let s=(g.attributes[e].value||"").match(r);if(s&&s[1]){let e=decodeURIComponent(String(s[1]).replace(/\+/g," ")),r=e;r=this.highlights.url_exact?this.simplify_url(e.toLowerCase(),this.highlights.url_keep_qs):this.simplify_url_domain(e.toLowerCase()),h==md5(n+r)&&(this.send_grabba_message({highhref:r,highcontent:g.textContent}),this.colorize_element(g,i,l),t&&this.save_serp_position(g,t),o+=1)}}}return o},hide_googleads:function(e){e=e||[["li.ads-ad","ol"],["li.ads-fr","ol"],["li[class*='ads-']","ol"],["div[aria-label='Ads']",null],["div#tvcap",null],["div#tads",null],["div#topads",null],["div#bottomads",null],["div.ad_cclk",null],["a[href*='googleadservices']","div"],["w-visurl","a"],["a[onmousedown*='google.arwt']","div"],["a[onmousedown*='window[this.getAttribute(\\'data-mousedown\\')](this)']","div"],["a[href*='/aclk?'][data-al]","div"],["a[data-tu*='/aclk?']","div"],["div[data-result-ad-type]","div"],["a[data-rw*='/aclk?']","div"],[".commercial-unit-desktop-rhs",null],[".commercial-unit-desktop-top",null],[".commercial-unit-mobile-top",null],[".commercial-unit-mobile-bottom",null]],this.hide_ads(e);let t=document.querySelectorAll("a");for(let e=0;e<t.length;e++){let i=t[e];for(let e=0;e<i.attributes.length;e++){let t=i.attributes[e];/^data-|^href/i.test(t.nodeName)&&/googleadservices\.com|\/aclk\?sa=/i.test(t.nodeValue)&&(this.hide_ad_el(i),!i||"A"!=i.tagName&&"a"!=i.tagName||i.setAttribute("href","https://google.com/?dbltap"))}}},hide_utubeads:function(e){e=e||[[".masthead-ad-control",null],["#masthead-ad",null],["#promotion-shelf",null],[".ad-div",null],[".ytp-ad-module",null],[".ytd-carousel-ad-renderer",null],["ytd-promoted-sparkles-web-renderer",".ytd-item-section-renderer"],["ytm-promoted-sparkles-web-renderer",".ytd-item-section-renderer"]],this.hide_ads(e)},hide_ads:function(e){for(let t=0;t<e.length;t++){let i=document.querySelectorAll(e[t][0]),l=e[t][1];for(let e=0;e<i.length;e++){let t=i[e],o=l?t.closest(l):t;o&&this.hide_ad_el(o)}}},hide_ad_el:function(e){try{e.style.display="none",e.style.visibility="hidden",e.style.opacity="0.1",e.style.backgroundColor="green",e.style.height="3px",e.style.overflow="hidden",e.disabled=!0}catch(e){}},colorize_element:function(e,t,i){try{t?this.colorize_element_default(e,t,i):window.location.href.toString().includes("google.")?this.colorize_element_google(e,t):window.location.href.toString().includes("youtube.")?this.colorize_element_google(e,"ytd-video-renderer"):window.location.href.toString().includes("bing.")?this.colorize_element_bing(e):this.colorize_element_default(e)}catch(e){}},colorize_element_google:function(e,t){let i=e.closest(t||"div");i?(e.style.color="maroon",e.style.fontWeight="bold",i.classList.contains("osl")?(i.style.backgroundColor="#ffd7d7",i.style.boxShadow="0 0 4px coral",i.style.border="1px solid #fddd9b",e.style.backgroundColor="lightyellow"):(i.style.backgroundColor="#ff8787",i.style.boxShadow="0 0 4px coral",i.style.border="1px solid #fddd9b")):this.colorize_element_default(e)},colorize_element_google_maps:function(e){e.style.backgroundColor="#b1ff87",e.style.color="#004400",e.style.fontWeight="bold",e.style.border="2px solid crimson",e.style.padding="2px 6px",e.style.boxShadow="0 0 20px coral"},colorize_element_google_images:function(e){e.style.border="5px solid coral",e.style.boxShadow="0 0 20px yellow",e.style.backgroundColor="#b1ff87";let t=e.parentNode.childNodes;for(let i=0;i<t.length;i++)t[i]!=e&&(t[i].style.backgroundColor="gold",t[i].style.color="black")},colorize_element_bing:function(e){let t=e.closest("li.b_algo")||e.parentNode;t.style.backgroundColor="#ff8787",t.style.boxShadow="0 0 3px coral",e.style.color="maroon",e.style.fontWeight="bold"},colorize_element_default:function(e,t,i){e.style.backgroundColor="#ff8787",e.style.color="#ffff7f",e.style.fontWeight="bold",e.style.boxShadow="3px 3px 8px #fddd9b, 0 0 5px #fddd9b inset",e.style.border="2px solid #fddd9b",e.style.padding||(e.style.padding="7px");let l=t&&e.closest(t)||e.parentNode;if(l&&(l.style.backgroundColor="lightyellow",l.style.boxShadow="0 0 3px yellow inset, 0 0 3px #ffd7d7",l.style.border="2px solid #ffd7d7"),i){let t=e.querySelector(i);t&&(t.style.backgroundColor="lightyellow",t.style.boxShadow="3px 3px 8px salmon, 0 0 5px salmon inset",t.style.border="3px solid red","img"==i&&(t.style.filter="saturate(2.00) contrast(1.33) drop-shadow(0 0 10px crimson)"))}},save_serp_position:function(e,t,i){let l=e.closest(i||t);if(!l)return;let o=b=0,s=c2=l;for(;null!=(s=s.previousSibling);)o++;for(;null!=(c2=c2.nextSibling);)b++;let h=bx=0,n=cx2=e;for(;null!=(n=n.previousSibling);)h++;for(;null!=(cx2=cx2.nextSibling);)bx++;let r=document.querySelectorAll(t),g=0,a=null;for(g=0;g<r.length;g++)if(r[g].isSameNode(l)){a=g;break}let d=new URLSearchParams(window.location.search),c=Number(d.get("start"))||Number(d.get("first"))||0,u=r&&r.length||0,_=String(l.textContent).replace(/[\n\r\s]{2,}/gi," ").trim(),m=[o,b,a,c,u,h,bx];this.serp_positions&&this.serp_positions.length,this.serp_positions.push(m),this.send_grabba_message({serp_position:this.serp_positions[0],serp_positions:this.serp_positions,serp_box:_.substr(0,100),serp_box_class:l.className})},simplify_url:function(e,t){if(!e||String(e).match(/^(about|chrome|javascript|file):/gi))return null;e.indexOf("://")<0&&(e="https://"+e);let i=null;try{i=new URL(e)}catch(e){return null}let l=String(i.hostname).replace(/^www\./gi,""),o=String(i.pathname).replace(/\/$/gi,""),s=Array.from(i.searchParams),h="";if(t){let e=s.filter((e=>e[0]&&t.indexOf(e[0])>=0));if(e.length>0&&t.length>0){e.sort((function cmp(e,t){return e[0]>t[0]?1:e[0]<t[0]?-1:0}));for(let t=0;t<e.length;t++)h+=(0==t?"?":"&")+e[t][0]+"="+e[t][1]}}return`${l}${o}${h}`},simplify_url_domain:function(e){if(!(e=this.simplify_url(e)))return null;e="http://"+e;try{let t=new URL(e);return String(t.hostname).replace(/^www\./gi,"").toLowerCase()}catch(e){return null}},unpack_ggl_url:function(e){if(e&&e.includes("google.")&&e.includes("/url?q=http")){let t=new RegExp("/url\\?q=(http[^&]+)","ig").exec(e);if(t&&t[1])return decodeURIComponent(t[1].replace(/\+/g," "))}return e},send_grabba_message:function(e){let t=document.getElementById("search")||document.body,i=String(t.innerText).replace(/[\n\r\s]{2,}/gi," ").trim(),l={serppa:new Date(Date.now()).toISOString()||!0,pglocation:window.location.href.toString(),pgreferrer:document.referrer,pgcontent:i.substr(0,1024),pgtitle:document.title};(e||this.message_extras)&&(Object.assign(this.message_extras,e),Object.assign(l,this.message_extras)),browser.runtime.sendMessage(l)},get_xyz:function(e){return[e.pageX,e.pageY,e.clientX,e.clientY,e.offsetX,e.offsetY,(new Date).getTime()]}},window.highlighter_injected=!0,"complete"==document.readyState?window.highlighter.highlight_delayed(333):window.addEventListener("load",(()=>{window.highlighter.highlight_delayed(333)})),window.addEventListener("mousedown",(()=>{window.highlighter.highlight_delayed(1250)})),browser.runtime.onMessage.addListener((e=>{e&&e.highlights&&(window.highlighter.highlights=e.highlights||[],"complete"!=document.readyState&&"interactive"!=document.readyState||window.highlighter.highlight_delayed(500)),e&&e.grabba&&window.highlighter.send_grabba_message(),e&&e.highdisable&&(window.highlighter.disabled=!0)})));